# VOD 서비스를 위한 QUIC 기반 LL-HLS 개발

# 0. 요약
VOD 서비스 시장은 지속적으로 성장하여 사용자 경험을 개선할 필요가 요구되어 왔다. 기존의 HTTP 기반 스트리밍 방식은 세그먼트 단위 분할 및 전송으로 인한 본질적 지연과 하위 계층 전송 프로토콜인 TCP의 기술적인 한계로 빠른 시청 시작, 네트워크 변화에 대한 취약성 등의 문제를 겪고 있다. 본 논문은 이러한 사용자 경험을 개선하기 위한 방안으로 저지연 스트리밍 기술인 LL-HLS와 차세대 전송 프로토콜인 QUIC(HTTP/3)을 VOD 서비스에 결합하는 새로운 접근 방식을 제안하고 구현하였다. 이를 통해 아직 적용 사례가 많지 않은 QUIC 위의 LL-HLS(LL-HLS over QUIC) 시스템에 대한 기술적 타당성과 이에 대한 실제 구현 가능성을 입증한다.

# 1. 서론
현대 사회에서 VOD(Video On Demand) 서비스는 주요 디지털 컨텐츠 소비 형태로 자리 잡으며 폭발적으로 성장하고 있다. 특히 사용자들의 요구 수준 상승에 따라 끊김 없는 영상 시청 경험, 즉각적 탐색, 빠른 재생 시작 등과 같은 사용자 경험의 개선이 서비스 경쟁력 확보에 필수적인 과제로 대두되었다. 이에 따라 영상 전송 기술은 Progressive Download 등의 방식에서 영상을 청크 단위로 나눠 전송하는 RTSP 등이 등장하고, 강력한 기존 인프라인 웹을 활용한 HTTP 기반 Adaptive Streaming(HLS, DASH 등)으로 발전했다. 하지만 주로 사용되는 HTTP 기반 스트리밍 기술들은 영상을 세그먼트 단위로 처리하여 전송하기 때문에 Startup Latency 등 본질적인 지연이 발생하게 된다. 스트리밍 서비스의 기반이 되는 기존 전송 프로토콜인 TCP와 위에서 동작하는 HTTP/1.1, HTTP/2는 3-Way Handshake와 같은 연결 설정 과정에서의 시간 소요, HOL Blocking(Head-Of-Line Blocking) 문제, 연결 환경 변화 시 필요로 하는 재연결 등 기술적 한계가 내포되어 있으며 이는 VOD 서비스의 스트리밍 성능과 안정성 저하의 원인이 될 수 있다.
이러한 배경에서 스트리밍 서비스의 지연 문제를 효과적으로 해결하기 위해 Low-Latency HLS(LL-HLS), Low-Latency DASH(LL-DASH) 등 저지연 스트리밍 기술 표준이 등장했다. 동시에 전송 계층에서는 HTTP/2의 HOL Blocking 문제를 근본적으로 해결하고 연결 설정을 최적화하기 위해 UDP 기반 전송 프로토콜인 QUIC 및 이를 기반으로 하는 HTTP/3가 IETF를 통해 표준화되었다. QUIC은 0~1 RTT(Round Trip Time)의 빠른 연결 설정, 독립 스트림 데이터 전송, Connection Migration 등 VOD 서비스의 클라이언트 경험을 크게 개선할 수 있는 기능이 존재한다. 그러나 오픈소스를 통해 LL-HLS가 제공하는 저지연 스트리밍의 이점과 QUIC(HTTP/3)이 제공하는 전송 효율성 및 연결 안정성을 VOD 서비스에 통합적으로 적용하려는 시도는 아직 초기 단계에 머무르고 있으며, 실제 구현 및 검증 사례는 부족한 실정이다.
따라서 본 논문은 VOD 서비스 환경에 최적화된 QUIC 기반 HTTP/3 서버에서 LL-HLS 프로토콜을 사용해 컨텐츠를 효율적으로 전송하기 위한 서버를 직접 설계하고 구현한다. 이를 통해 VOD 서비스의 Startup Latency 감소를 통한 재생 시작 시간 단축, 컨텐츠 서빙의 네트워크 변화에 대한 내성 등을 개선하고 향후 차세대 고성능 VOD 스트리밍 시스템 구축에 기여할 것을 기대한다.

# 2. 이론적 배경 및 관련 연구
## 2.1 비디오 전송 기술
VOD 서비스가 대중화되기 시작하며 초기에는 당시의 네트워크 환경과 기술 수준 등을 반영한 다양한 비디오 전송 기술들이 발전 및 사용되었다. 이는 추후 등장하는 HLS(HTTP Live Streaming)와 같은 적응형 스트리밍 기술의 필요성을 이해하는 데 중요한 배경을 제공한다. 본 절에서는 주요 비디오 전송 기술의 발전을 특징, 한계에 초점을 맞춰 기술한다.

### 2.1.1 기존 주요 비디오 전송 기술의 발전
#### 가. 비디오 다운로드
초기 영상 컨텐츠를 서버에서 클라이언트로 전송하기 위해 비디오 파일 전체를 사용자 기기에 완전히 다운로드한 뒤 재생하는 방식이 FTP 또는 HTTP 위에서 사용되었다. 해당 방식은 구현이 단순하지만 사용자는 파일이 모두 다운로드될 때까지 기다려야 하므로 용량이 큰 비디오 파일의 경우 시청을 시작하는 데 오랜 시간이 소요된다는 단점이 있다. 또한, 파일의 특정 부분만 선택하여 시청하기 위한 임의 접근(Random Access)이나 탐색(Seeking) 기능이 제한적이었다.
이런 단점을 극복하기 위해 HTTP 프로토콜의 발전에 따라 비디오 등 미디어 파일의 앞부분부터 순차적으로 다운로드하면서 재생이 가능하게 하는 Progressive Download 방식이 등장했다. 이는 서버에 저장된 미디어 파일을 내려받는 동시에, 클라이언트의 미디어 플레이어는 수신된 데이터가 일정량 이상 버퍼링되면 즉시 재생을 시작하는 방식으로 동작한다. 특히 1990년대 중반, 주로 다이얼업 모뎀이나 초기 ISDN 환경에서 인터넷 대역폭이 현재보다 훨씬 제한적이고 불안정했을 때 사용자는 파일 전체가 다운로드될 때까지 기다릴 필요 없이 미디어 콘텐츠를 보다 빠르게 접할 수 있게 되어 사용자 경험이 크게 향상되었다. 하지만 이는 네트워크 대역폭 변화에 적응하여 화질을 동적으로 변경하는 기능이 부재했고 사용자의 능동적 탐색 지원이 미흡했으며, 한 번 재생이 시작되면 사용자의 네트워크 상태가 나빠져도 동일한 품질로 계속 다운로드를 시도하여 버퍼링이 길어지거나 재생이 중단될 수 있는 단점이 여전히 존재했다.
이러한 비디오 다운로드 방식의 한계와 더불어 라이브 이벤트 중계와 같은 실시간성에 대한 요구가 커지면서 단순 다운로드 방식으로만 서비스를 구성하기 어려워졌다. 이에 따라 각종 스트리밍 프로토콜들이 등장하여 실시간 데이터 전송과 제어 기능을 제공하려는 시도들이 이루어졌다.

#### 나. 비디오 스트리밍
비디오 스트리밍은 데이터를 작은 단위의 패킷으로 분할하여 연속적인 흐름인 스트림 형태로 전송하고, 클라이언트는 이를 수신하는 즉시 버퍼링 후 디코딩하여 재생함으로써 대기 시간을 최소화하는 것을 목표로 한다. 이에 초기 스트리밍 기술은 주로 실시간 전송과 재생 제어에 초점을 맞추어 발전했다. 특히 1990년대 중반에는 독자적인 실시간 스트리밍 기술들이 등장하기 시작했다. 1995년 4월 RealNetwork 사에서 출시한 RealAudio는 독자적으로 개발한 당시로서 획기적인 실시간 오디오 스트리밍 기술을 선보여 주목을 받았으며 Microsoft 사에서는 이에 대응하여 NetShow를 1996년에 발표하며 스트리밍 시장에 진출했다. NetShow는 이후 Windows Media Services로 발전하였고, TCP 또는 UDP를 통해 유니캐스트 데이터를 전송하는 독자적인 MMS(Microsoft Media Server) 프로토콜을 사용하여 미디어를 스트리밍했다.
한편, 특정 기업에 종속되지 않는 표준화된 스트리밍 프로토콜이 IETF(Internet Engineering Task Force)를 중심으로 개발이 진행되었다. 1996년 처음 제안된 RTP(RFC 3550)는 오디오 및 비디오와 같은 실시간 데이터를 IP 네트워크를 통해 전송하기 위한 종단 간 전송 프로토콜이다. 이는 데이터의 시간 정보를 포함한 지터 보상(수신 측에서 패킷 도착 시간의 불규칙성을 보정하는 기능) 및 패킷 손실 감지 등을 지원하지만 데이터 전송 자체의 신뢰성을 보장하거나 지연시간을 제어하지 않는다. (+RTSP, RTMP)
이러한 초기 및 기존 비디오 전송 기술들은 각각의 장점과 함께 명확한 한계점을 가지고 있었으며, 이는 특히 HTTP 인프라의 광범위한 보급과 함께 웹 환경에 더 친화적이고 네트워크 변화에 유연하게 대응할 수 있는 새로운 스트리밍 기술의 필요성을 증대시켰다.
  
### 2.1.2 HLS와 LL-HLS
앞서 언급된 기존 비디오 전송 기술들의 한계를 극복하기 위해 널리 사용되고 있는 웹 인프라를 효과적으로 활용하는 HTTP 기반 적응형 스트리밍(Adaptive Bitrate Streaming over HTTP) 기술이 등장했다. 대표적으로는 Apple 사에서 개발하고 RFC로 표준화된 HLS(HTTP Live Streaming), ISO/IEC 국제 표준인 MPEG-DASH(Dynamic Adaptive Streaming over HTTP) 등이 있다. Apple 사에서 2009년에 발표한 HLS는 HTTP 기반으로 동작하는 적응형 비트레이트 스트리밍 프로토콜로, 원본 비디오를 여러 화질로 세분화하고 짧은 길이로 자른 세그먼트 파일들과 세그먼트들의 목록 및 메타데이터를 담은 매니페스트 파일로 재구성하여 클라이언트의 네트워크 상태에 따라 적절한 화질의 세그먼트를 전송하여 최대한 끊김 없는 시청 경험을 제공하려고 노력한다(문장 끊기?). HLS는 HTTP에서 동작하기 때문에 방화벽 문제로부터 보다 자유롭고 CDN(Content Delivery Network)을 활용한 효율적인 콘텐츠 전송이 가능하여 대규모 스트리밍 서비스 구축에 유리하다. MPEG-DASH는 HLS와 유사하게 미디어를 세그먼트로 분할하고 매니페스트 파일인 MPD(Media Presentation Description)를 통해 클라이언트에게 다양한 품질의 스트림 정보를 제공한다. 이는 codec-agnostic한 특징을 가졌으며 공통 암호화와 같은 DRM(Digital Rights Management) 표준과의 연동성 또한 고려되어 있다. 본 논문에서 제안하는 시스템은 HLS를 기반으로 구현되었으므로 이후 HLS를 중심으로 기술한다.
HLS 및 MPEG-DASH는 안정적인 스트리밍 환경을 제공하는 데 크게 기여했지만 라이브 스트리밍처럼 실시간 상호작용이 중요한 서비스에서는 높은 지연 시간이 문제가 되었다. 이러한 수십 초에 달하기도 하는 지연 시간은 주로 세그먼트 단위로 미디어를 처리하고 버퍼링하는 방식 자체에서 발생한다. 이를 해결하기 위해 기존 HLS와 MPEG-DASH를 확장해 지연 시간을 수 초 이내로 단축하는 저지연 스트리밍 기술인 LL-HLS 및 LL-DASH가 등장했다. LL-HLS는 부분 세그먼트(Partial Segments) 전송, Delta Playlist Update, Blocking Playlist Reload, Preload Hint 등의 기술을 도입해 세그먼트 전체가 완성되기 전에도 미디어 청크를 전송하고 플레이어가 빠르게 이를 로드할 수 있도록 하여 지연 시간을 크게 단축시켰다.

## 2.2 HTTP
HTTP는 월드 와이드 웹에서 정보를 주고받기 위한 핵심 응용 계층 프로토콜로, 초기의 HTTP/0.9부터 HTTP/1.0, HTTP/1.1을 거쳐 HTTP/2, 그리고 최근의 HTTP/3에 이르기까지 지속적으로 발전해왔다. (HTTP/3을 채택한 것에 대한 당위성 부여 필요)
## 2.2.1 SPDY, HTTP/2
HTTP/1.1은 오랜 기간 동안 웹 통신의 기반이 되었지만 몇 가지 성능 상 한계가 존재했다. 대표적으로 하나의 TCP 연결에서 한 번에 하나의 요청과 응답만을 처리하는 순차적 처리 방식, 비교적 큰 텍스트 기반 헤더 및 HOL(Head-Of-Line) 블로킹 등이 문제점으로 지적되었다. 이러한 한계를 극복하기 위해 Google 사에서 2009년 SPDY라는 실험적 프로토콜을 개발했다. SPDY는 단일 TCP 연결 상에서 여러 요청을 동시에 처리할 수 있는 다중화(Multiplexing), 요청 우선순위 지정, 헤더 압축(HPACK) 등의 기능을 도입하여 웹 페이지 로딩 속도를 개선하고자 했다. 즉 SPDY는 HTTP를 대체하려는 프로토콜이 아닌 HTTP의 의미론을 유지하며 전송 방식을 개선하는 형태로 제안되었다. 이를 바탕으로 IETF HTTPbis 워킹 그룹은 HTTP/2 표준화 작업을 진행해 2015년 공식적으로 RFC 7540으로 HTTP/2를 발표했다. 이는 하나의 TCP 연결을 통해 여러 요청과 응답을 동시에 양방향으로 스트림 형태로 주고받을 수 있게 되어 응용 계층에서의 HOL 블로킹 문제를 완화하였다. 그러나 HTTP/2는 여전히 전송 계층 프로토콜로 TCP를 사용하기 때문에 TCP 계층에서의 HOL 블로킹 문제는 해결하지 못 했다.(HOL 블로킹 인용 추가)

## 2.2.2 QUIC, HTTP/3
전송 계층 프로토콜인 TCP에 의해 발생하는 HOL 블로킹 문제를 해결하기 위해 UDP 기반의 전송 프로토콜인 QUIC(Quick UDP Internet Connections)이 개발되었고 QUIC 위에서 동작하는 HTTP/3이 등장하게 되었다. QUIC은 TCP와 같은 기존 전송 프로토콜 대비 HTTP 트래픽을 가속화하고 HTTP/2와 같은 다중화 및 흐름 제어, TLS(Transport Layer Security)와 동등한 보안, TCP와 동일한 안정성 및 혼잡 제어를 제공하는 것을 목표로 한다. 이는 2012년 Jim Roskind에 의해 디자인되어 실험이 진행되었고 이후 IETF에서 표준화 작업을 거쳐 RFC 9000 등으로 발표되었다. 이외에도 QUIC은 TCP의 3-way handshake와 TLS handshake 과정을 통합하여 이전에 서버와 통신한 적이 없는 경우에는 1-RTT(Round Trip Time), 통신한 적이 있는 경우 0-RTT 만에 연결 설정을 완료하며 스트림을 다중화해 데이터를 병렬로 전송할 수 있다. 또한 한 스트림에서 데이터가 지연되거나 손실되어도 다른 스트림의 데이터 전송에 영향을 미치지 않아 TCP에서의 HOL blocking 문제를 해결했으며 클라이언트의 IP 주소나 포트가 변경되어도 기존 연결을 중단 없이 유지할 수 있도록 지원한다.
HTTP/3는 QUIC 위에서 동작하도록 설계된 버전으로 RFC 9114로 표준화되었다. IETF는 인터넷 전송 프로토콜을 TCP에서 QUIC으로 변경하는 새로운 HTTP/3 초안을 2019년 1월에 발표한 바 있다. HTTP/3는 HTTP/2의 주요 의미론적 기능과 스트림 단위 흐름 제어 등을 계승하면서, 전송 계층으로 QUIC을 사용함으로써 TCP 기반 HTTP/2가 가졌던 한계점들을 극복하고자 한다. 이는 스트림 간 독립성을 보장하여 HOL 블로킹을 해결하고, 효율적인 혼잡 제어 및 빠른 연결 설정을 통해 TCP 기반 HTTP 대비 향상된 성능을 제공한다.
이처럼 HTTP/3(QUIC)는 TCP 기반 전송 프로토콜의 한계를 극복하고 저지연 스트리밍 환경 구축에 도움이 될 빠른 연결 수립, HOL 블로킹 없는 다중화 등의 기능을 제공한다. 이러한 특성들은 저지연을 목표로 하는 LL-HLS와 결합될 때 VOD 서비스의 초기 로딩 시간 단축, 재생 중 끊김 감소, 네트워크 환경 변화에 대한 대응력 향상 등 사용자 경험을 전반적으로 향상시킬 것으로 기대된다.

# 3. LL-HLS over QUIC(HTTP/3) 개발

# 4. 비교

# 5. 결론
본 논문은 VOD 서비스의 사용자 경험 향상을 위해 기존 HTTP 기반 스트리밍 기술의 전송 계층 측면의 한계를 극복하고자 차세대 전송 프로토콜인 QUIC(over HTTP/3)을 저지연 스트리밍 기술인 LL-HLS와 결합한 서버 시스템을 구현했다. 이는 아직 프로덕션 환경에서 널리 활용되지 않는 HTTP/3 전송 프로토콜 위에서 복잡성을 가지는 LL-HLS의 동작을 구현 및 연동함으로써 기술적 타당성을 보여준다는 의미가 있다. 구현 과정에서 LL-HLS 관련 오픈소스의 부재 등의 기술적 도전 과제에 직면했으며 이를 해결하여 Smart Origin Server 구성에 대한 실질적인 이해를 얻을 수 있었다. 해당 과정에서 얻은 기술적 경험과 시사점이 향후 실제 서비스에 HTTP/3 전송 프로토콜을 적용할 때 기반 정보를 제공할 수 있음을 기대한다.

# 참고문헌
## 1
- Schulzrinne, H., Rao, A., and Lanphier, R. "Real Time Streaming Protocol"
- https://www.cs.columbia.edu/~hgs/rtsp/draft/draft-ietf-mmusic-rtsp-03.html